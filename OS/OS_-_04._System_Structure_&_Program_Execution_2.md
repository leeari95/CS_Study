# OS - 04. System Structure & Program Execution 2

 > 본 글은 반효경 교수님의 [운영체제 강의(2014)](http://www.kocw.net/home/search/kemView.do?kemId=1046323) 내용에 대해 학습하고 정리한 내용입니다. 

</br>

## 동기식/비동기식 입출력


* 동기식 입출력 (synchronous I/O)
    * I/O 요청 후 입출력 작업이 완료된 후에야 제어가 사용자 프로그램에 넘어감
    * 구현방법
        * CPU를 빼앗지 않는 방법
            * I/O가 끝날 때까지 CPU를 낭비시킴
            * 매 시점 하나의 I/O만 일어날 수 있음
        * CPU를 빼앗는 방법
            * I/O가 완료될 때까지 해당 프로그램에게서 CPU를 빼앗음
            * I/O 처리를 기다리는 줄에 그 프로그램을 줄 세움
            * 다른 프로그램에게 CPU를 줌 
* 비동기식 입출력 (asynchronous I/O)
    * I/O가 시작된 후 입출력 작업이 끝나기를 기다리지 않고 제어가 사용자 프로그램에 즉시 넘어감

> 두 경우 모두 I/O의 완료는 인터럽트로 알려준다.

![](https://i.imgur.com/XKGOZxG.png)

## DMA (Direct Memory Access)

![](https://i.imgur.com/n0pZ97Q.png)

* 빠른 입출력 장치를 메모리에 가까운 속도로 처리하기 위해 사용
* CPU의 중재 없이 디바이스 컨트롤러가 디바이스의 버퍼 스토리지의 내용을 메모리에 블럭 단위로 직접 전송
* 바이트 단위가 아니라 블럭 단위로 인터럽트를 발생시킨다.

## 서로 다른 입출력 명령어

![](https://i.imgur.com/1rQPnKe.png)

* I/O를 수행하는 special instruction에 의해
* Memory Mapped I/O에 의해

## 저장장치 계층 구조

![](https://i.imgur.com/9J57bxZ.png)

> 그림 상에서 밑으로 갈수록 느리고 위로 갈수록 빠른 속도차이가 있다.

* 휘발성
    * 레지스터, 캐시, 메인 메모리
* 비휘발성
    * 마그네틱 디스크, 옵티컬 디스크, 마그네틱 테이프

## 프로그램의 실행 (Memory load)

![](https://i.imgur.com/nVBqEvZ.png)

프로그램에는 보통 실행파일 형태로 하드디스크에 저장되어 있다. 이런 실행파일을 실행시키게 되면 그게 메모리로 올라가서 프로세스가 된다.

![](https://i.imgur.com/iu2ZTxX.png)

하지만 메모리에 바로 올라가는 것이 아니라 중간에 한단계를 더 거치게 되는데 그게 바로 Virtual Memory, 가상 메모리라는 단계이다. 
그래서 그 프로그램의 주소 공간이 형성이 되는데, 이것이 메모리 주소 공간이다. 
따라서 각 프로그램마다 독자적인 주소 공간을 가지고 있는데, 이거를 물리적인 메모리에 올려서 실행을 시키는 것이다.
컴퓨터를 부팅을 하면 커널은 죽지않고 항상 상주해있지만 사용자 프로그램들은 실헹을 시키면 이러한 주소 공간이 생겼다가 프로그램이 종료되면 사라지게 된다.
물리적인 메모리에 주소공간을 모두 다 올려놓는 것은 아니다. 그렇게 되면 메모리 낭비가 생기기 때문에 당장 필요한 부분만 올려놓게 된다. 메모리에 올라가지 않은 부분은 디스크에 내려놓게 된다. 디스크 중에 Swap Area라는 곳에 내려놓게 되는 것이다.
</br>

정리하자면,
* 프로그램마다 존재하는 가상 메모리는 어디에 연속적으로 할당되지 않는다.
* 쪼개져가지고 어떤 부분은 물리적인 메모리, 어떤 부분은 Swap area에 있고...
* 각 프로그램마다 독자적인 메모리 공간을 가상메모리라고 불려진다.
</br>


## 커널 주소 공간의 내용

![](https://i.imgur.com/xiDwn9w.png)

* code
    * 시스템콜, 인터럽트 처리 코드
    * 자원 관리를 위한 코드
    * 편리한 서비스 제공을 위한 코드
* data
    * 운영체제가 사용하는 자료구조가 있다.
    * PCB(Process Control Block)
    * CPU, Memory, Disk
* stack
    * 프로세스의 커널 스택
        * A라는 사용자 프로그램이 시스템 콜하면 프로세스 A의 커널 스택이 생긴다.
        * 프로그램마다 별도로 관리한다.

## 사용자 프로그램이 사용하는 함수

* 사용자 정의 함수
    * 자신의 프로그램에서 정의한 함수
* 라이브러리 함수
    * 자신의 프로그램에서 정의하지 않고 갖다 쓴 함수
    * 자신의 프로그램의 실행 파일에 포함되어 있다.

> 이는 모두 특정 사용자 프로그램의 프로세스 주소 공간의 code 영역에 할당된다.

* 커널 함수
    * 운영체제 프로그램의 함수
    * 커널 함수의 호출 = 시스템 콜

> 이는 커널 주소 공간의 code 영역에 할당된다.

## 프로그램의 실행

![](https://i.imgur.com/gRDuBTa.png)

> User 모드, Kernel 모드를 돌면서 실행하는 형태이다.
